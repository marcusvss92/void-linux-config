# Dracut configuration for LUKS encryption
# Place in /etc/dracut.conf.d/10-luks.conf

# ============= LUKS MODULES =============

# Essential modules for LUKS
add_dracutmodules+=" crypt dm "

# For LVM on LUKS (if using)
# add_dracutmodules+=" lvm "

# ============= CONFIGURATION FILES =============

# Include crypttab for automatic LUKS handling
install_items+=" /etc/crypttab "

# Include LVM configuration if using LVM
# install_items+=" /etc/lvm/lvm.conf "

# ============= KERNEL PARAMETERS =============

# Allow TRIM/discard for SSDs with LUKS
kernel_cmdline+=" rd.luks.allow-discards "

# Timeout for LUKS password prompt (seconds)
# kernel_cmdline+=" rd.luks.timeout=60 "

# Specify LUKS device explicitly (optional)
# Replace UUID with your LUKS partition UUID
# kernel_cmdline+=" rd.luks.uuid=12345678-1234-1234-1234-123456789abc "

# ============= FILESYSTEM SUPPORT =============

# Ensure VFAT support for EFI partition
filesystems+=" vfat "

# Add your root filesystem type
#  filesystems+=" ext4 "
# Or for Btrfs:
filesystems+=" btrfs "

# ============= OPTIMIZATION =============

# Only include essential items for LUKS
omit_items+=" /usr/bin/plymouth "

# ============= ADVANCED OPTIONS =============

# For detached LUKS headers (if implementing in future)
# install_items+=" /path/to/luks.header "

# For keyfiles (if using)
# install_items+=" /etc/luks-keyfile "

# Custom LUKS script (if needed)
# install_items+=" /usr/local/bin/luks-unlock.sh "

# ============= DEBUGGING =============

# Uncomment for LUKS debugging (remove in production)
# kernel_cmdline+=" rd.luks.debug "
# kernel_cmdline+=" rd.debug "

# ============= NOTES =============

# - This file is included automatically by dracut
# - Regenerate initramfs after changes: dracut --force
# - Test boot after any changes
# - Keep backup of working initramfs
# - Check /proc/cmdline after boot to verify parameters

#!/bin/bash
# /usr/local/bin/setup-multi-user-pentesting.sh

create_users() {
    echo "Creating pentesting users..."
    
    # Pentester user
    useradd -m -s /bin/zsh -G wheel,wireshark,dialout,netdev pentester
    
    # Developer user  
    useradd -m -s /bin/zsh -G wheel,docker,vboxusers developer
    
    # Sandbox user
    useradd -m -s /bin/bash sandbox
    
    echo "Users created successfully"
}

configure_doas() {
    echo "Configuring doas..."
    cp configs/doas/doas.conf /etc/doas.conf
    chmod 600 /etc/doas.conf
}

setup_environments() {
    echo "Setting up user environments..."
    
    # Pentester ZSH config
    doas -u pentester cp configs/zsh/zshrc-pentesting /home/pentester/.zshrc
    
    # Developer environment
    doas -u developer cp configs/zsh/zshrc-development /home/developer/.zshrc
    
    # Install user management scripts
    cp scripts/tools/switch-to-*.sh /usr/local/bin/
    cp scripts/tools/user-menu.sh /usr/local/bin/
    chmod +x /usr/local/bin/switch-to-*.sh
    chmod +x /usr/local/bin/user-menu.sh
}

echo "=== Multi-User Pentesting Setup ==="
create_users
configure_doas  
setup_environments

echo "âœ… Setup complete!"
echo "Use 'user-menu.sh' to switch between environments"

#!/bin/bash
# Switch to pentester user with environment setup

USER_TARGET="pentester"
PENTESTING_DIR="/home/$USER_TARGET/Pentesting"

echo "=== Switching to Pentester Environment ==="

# Setup pentesting directories
doas -u $USER_TARGET mkdir -p "$PENTESTING_DIR"/{targets,wordlists,exploits,loot,reports}

# Copy necessary files
if [[ ! -d "$PENTESTING_DIR/wordlists/SecLists" ]]; then
    echo "Setting up wordlists..."
    doas -u $USER_TARGET git clone https://github.com/danielmiessler/SecLists.git "$PENTESTING_DIR/wordlists/SecLists"
fi

# Set environment variables
cat > /tmp/pentester-env << 'EOF'
export PENTESTING_HOME="/home/pentester/Pentesting"
export WORDLISTS="$PENTESTING_HOME/wordlists"
export MSF_DATABASE_CONFIG="/home/pentester/.msf4/database.yml"

# Pentesting aliases
alias target='export TARGET'
alias wordlist='find $WORDLISTS -name "*.txt" | grep'
alias msfdb='doas /opt/metasploit/msfdb'

echo "ðŸŽ¯ Pentester environment loaded"
echo "ðŸ“‚ Pentesting directory: $PENTESTING_HOME"
echo "ðŸŽ¯ Set target with: target=<IP>"
EOF

doas -u $USER_TARGET cp /tmp/pentester-env /home/$USER_TARGET/.pentester-env
echo "source ~/.pentester-env" | doas -u $USER_TARGET tee -a /home/$USER_TARGET/.bashrc

# Switch to user
echo "Switching to $USER_TARGET user..."
echo "Type 'exit' to return to $(whoami)"
doas -u $USER_TARGET bash -l

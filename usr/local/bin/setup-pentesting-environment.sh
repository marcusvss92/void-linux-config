#!/bin/bash
# Complete pentesting environment setup

set -e

echo "=== Pentesting Environment Setup ==="

# Install base security tools
echo "Installing security tools..."
doas xbps-install -S \
    nmap masscan \
    wireshark tshark tcpdump \
    john hashcat \
    aircrack-ng \
    sqlmap \
    nikto gobuster \
    hydra medusa \
    binwalk foremost \
    netcat socat

# Install Metasploit Framework
echo "Installing Metasploit Framework..."
if [[ ! -f /usr/local/bin/msfconsole ]]; then
    ./install-metasploit-void.sh
else
    echo "Metasploit already installed"
fi

# Setup ZSH with pentesting configuration
echo "Setting up ZSH for pentesting..."
./setup-zsh-pentesting.sh

# Create pentesting directories
mkdir -p ~/Pentesting/{reconnaissance,exploitation,post-exploitation,reports}
mkdir -p ~/Pentesting/wordlists

# Download common wordlists
echo "Downloading wordlists..."
cd ~/Pentesting/wordlists

# SecLists
if [[ ! -d "SecLists" ]]; then
    git clone https://github.com/danielmiessler/SecLists.git
fi

# RockYou (if available)
if [[ ! -f "rockyou.txt" ]] && command -v john &>/dev/null; then
    find /usr/share -name "*.gz" -path "*/wordlists/*" -exec gunzip -c {} \; > rockyou.txt 2>/dev/null || true
fi

# Configure Wireshark for non-root
doas usermod -aG wireshark $USER

# Setup Burp Suite (if available)
echo "Burp Suite installation instructions:"
echo "1. Download from PortSwigger website"
echo "2. Install to /opt/burpsuite"
echo "3. Create desktop shortcut"

# Create pentesting aliases
cat >> ~/.bash_aliases << 'EOF'
# Pentesting aliases
alias nse='ls /usr/share/nmap/scripts/ | grep'
alias httpserver='python3 -m http.server 8080'
alias phpserver='php -S 0.0.0.0:8080'
alias enum4linux='enum4linux.py'
EOF

echo "âœ… Pentesting environment setup completed!"
echo ""
echo "Tools installed:"
echo "- Network: nmap, masscan, netcat"
echo "- Web: nikto, gobuster, sqlmap"
echo "- Password: john, hashcat, hydra"
echo "- Wireless: aircrack-ng"
echo "- Analysis: wireshark, binwalk"
echo "- Framework: Metasploit"
echo ""
echo "Restart terminal to apply group changes"
echo "Run 'msfconsole' to start Metasploit"
